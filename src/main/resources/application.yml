server:
  port: 8090
logging:
  level:
    org.springframework.cloud: DEBUG
    org.springframework.cloud.gateway: DEBUG
    org.springframework.cloud.gateway.route.RouteDefinitionLocator: DEBUG
jwt:
  secret-key: 6IjGfzxL2HkVz2/ejQ9tNj3YjwX2DPFNUKOSqEM7g6I=

spring:
  application:
    name: gateway-service
  cloud:
    gateway:
      routes:
        # ========================================
        # RUTAS PÚBLICAS (sin autenticación)
        # ========================================
        - id: usuario-registro-publico
          uri: http://localhost:8081
          predicates:
            - Path=/arka/usuarios
            - Method=POST
          filters:
            - RewritePath=/arka/usuarios, /api/usuarios

        # ========================================
        # RUTAS SOLO PARA ADMIN
        # ========================================
        - id: usuario-crear-admin
          uri: http://localhost:8081
          predicates:
            - Path=/arka/usuarios/admin
            - Method=POST
          filters:
            - JwtAuthenticationFilter
            - AdminAuthorizationFilter
            - RewritePath=/arka/usuarios/admin, /api/usuarios/admin

        - id: usuario-listar-todos
          uri: http://localhost:8081
          predicates:
            - Path=/arka/usuarios
            - Method=GET
          filters:
            - JwtAuthenticationFilter
            - AdminAuthorizationFilter
            - RewritePath=/arka/usuarios, /api/usuarios

        # PROVEEDORES - SOLO ADMIN
        - id: proveedores-crear
          uri: http://localhost:8081
          predicates:
            - Path=/arka/proveedores
            - Method=POST
          filters:
            - JwtAuthenticationFilter
            - AdminAuthorizationFilter
            - RewritePath=/arka/proveedores, /api/proveedores

        - id: proveedores-listar
          uri: http://localhost:8081
          predicates:
            - Path=/arka/proveedores
            - Method=GET
          filters:
            - JwtAuthenticationFilter
            - AdminAuthorizationFilter
            - RewritePath=/arka/proveedores, /api/proveedores

        - id: proveedores-por-id
          uri: http://localhost:8081
          predicates:
            - Path=/arka/proveedores/{id}
            - Method=GET
          filters:
            - JwtAuthenticationFilter
            - AdminAuthorizationFilter
            - RewritePath=/arka/proveedores/(?<id>.*), /api/proveedores/$\{id}

        - id: proveedores-actualizar
          uri: http://localhost:8081
          predicates:
            - Path=/arka/proveedores/{id}
            - Method=PUT
          filters:
            - JwtAuthenticationFilter
            - AdminAuthorizationFilter
            - RewritePath=/arka/proveedores/(?<id>.*), /api/proveedores/$\{id}

        # ========================================
        # RUTAS AUTENTICADAS (cualquier usuario)
        # ========================================

        # USUARIOS
        - id: usuario-por-id
          uri: http://localhost:8081
          predicates:
            - Path=/arka/usuarios/{id}
            - Method=GET
          filters:
            - JwtAuthenticationFilter
            - RewritePath=/arka/usuarios/(?<id>.*), /api/usuarios/$\{id}

        - id: usuario-por-email
          uri: http://localhost:8081
          predicates:
            - Path=/arka/usuarios/email/{email}
            - Method=GET
          filters:
            - JwtAuthenticationFilter
            - RewritePath=/arka/usuarios/email/(?<email>.*), /api/usuarios/email/$\{email}

        - id: usuario-actualizar-password
          uri: http://localhost:8081
          predicates:
            - Path=/arka/usuarios/update-password
            - Method=PUT
          filters:
            - JwtAuthenticationFilter
            - RewritePath=/arka/usuarios/update-password, /api/usuarios/update-password

        - id: usuario-actualizar-datos
          uri: http://localhost:8081
          predicates:
            - Path=/arka/usuarios/update-user
            - Method=PUT
          filters:
            - JwtAuthenticationFilter
            - RewritePath=/arka/usuarios/update-user, /api/usuarios/update-user

        - id: usuario-eliminar
          uri: http://localhost:8081
          predicates:
            - Path=/arka/usuarios/{id}
            - Method=DELETE
          filters:
            - JwtAuthenticationFilter
            - RewritePath=/arka/usuarios/(?<id>.*), /api/usuarios/$\{id}

        # DIRECCIONES - AUTENTICADAS
        - id: direcciones-crear
          uri: http://localhost:8081
          predicates:
            - Path=/arka/usuarios/{idUsuario}/direcciones
            - Method=POST
          filters:
            - JwtAuthenticationFilter
            - RewritePath=/arka/usuarios/(?<idUsuario>.*)/direcciones, /api/usuarios/$\{idUsuario}/direcciones

        - id: direcciones-listar
          uri: http://localhost:8081
          predicates:
            - Path=/arka/usuarios/{idUsuario}/direcciones
            - Method=GET
          filters:
            - JwtAuthenticationFilter
            - RewritePath=/arka/usuarios/(?<idUsuario>.*)/direcciones, /api/usuarios/$\{idUsuario}/direcciones

        - id: direcciones-principal
          uri: http://localhost:8081
          predicates:
            - Path=/arka/usuarios/{idUsuario}/direcciones/principal
            - Method=GET
          filters:
            - JwtAuthenticationFilter
            - RewritePath=/arka/usuarios/(?<idUsuario>.*)/direcciones/principal, /api/usuarios/$\{idUsuario}/direcciones/principal

        - id: direcciones-actualizar
          uri: http://localhost:8081
          predicates:
            - Path=/arka/usuarios/{idUsuario}/direcciones/{idDireccion}
            - Method=PUT
          filters:
            - JwtAuthenticationFilter
            - RewritePath=/arka/usuarios/(?<idUsuario>.*)/direcciones/(?<idDireccion>.*), /api/usuarios/$\{idUsuario}/direcciones/$\{idDireccion}

        - id: direcciones-eliminar
          uri: http://localhost:8081
          predicates:
            - Path=/arka/usuarios/{idUsuario}/direcciones/{idDireccion}
            - Method=DELETE
          filters:
            - JwtAuthenticationFilter
            - RewritePath=/arka/usuarios/(?<idUsuario>.*)/direcciones/(?<idDireccion>.*), /api/usuarios/$\{idUsuario}/direcciones/$\{idDireccion}

        # ========================================
        # OTROS MICROSERVICIOS (sin cambios)
        # ========================================
        - id: catalogo-service
          uri: http://localhost:8082
          predicates:
            - Path=/api/productos/**

        - id: notificacion-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/notificaciones/**otificaciones/**